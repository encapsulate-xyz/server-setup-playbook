---
- name: Include create user task for ansible_username
  ansible.builtin.include_tasks: tasks/create_user.yml
  vars:
    shell: /bin/bash
    is_system_user: false
    user_name: "{{ ansible_username }}"
    allow_passwordless_sudo: true

- name: Include create user task for devops_username
  ansible.builtin.include_tasks: tasks/create_user.yml
  vars:
    shell: /bin/bash
    is_system_user: false
    user_name: "{{ devops_username }}"
    user_groups: [adm, systemd-journal]

- name: Add authorized keys for ansible and devops
  ansible.posix.authorized_key:
    user: "{{ item.user }}"
    key: "{{ lookup('file', playbook_dir + '/keys/' + item.key) }}"
    exclusive: true
  loop:
    - { user: "{{ ansible_username }}", key: "{{ ansible_username }}.pub" }
    - { user: "{{ devops_username }}", key: "{{ devops_username }}.pub" }
